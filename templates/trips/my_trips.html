{# templates/trips/my_trips.html #}
{% extends "base.html" %}
{% block title %}My Trips Â· TripTrack{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto space-y-8 animate-fade-in">

  <header class="text-center">
    <h1 class="text-3xl sm:text-4xl font-heading font-bold text-slate-800 dark:text-slate-100">My Trips</h1>
    <p class="mt-2 text-slate-600 dark:text-slate-400">Here's a look at your upcoming and past adventures with us.</p>
  </header>

  {# Consistent "Verify Email" Banner #}
  {% if request.user.is_authenticated and not request.user.email_verified %}
    <div class="rounded-xl bg-amber-100 dark:bg-amber-900/30 p-4 border border-amber-200 dark:border-amber-500/30 shadow-sm">
      <div class="flex flex-wrap items-center justify-center sm:justify-between gap-3 text-center sm:text-left">
        <p class="text-sm font-medium text-amber-800 dark:text-amber-200">
          <span class="font-bold">Action Required:</span> Please verify your email to join new trips.
        </p>
        <a href="{% url 'accounts:resend-verification' %}" class="inline-block text-sm rounded-lg px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white font-semibold shadow-md tween">
          Resend Verification Link
        </a>
      </div>
    </div>
  {% endif %}

  {# New active trip banner #}
  {% if new_trip %}
    <section class="rounded-2xl border border-brand-200 dark:border-brand-900/50 bg-brand-50 dark:bg-brand-900/20 p-5 shadow-lg">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h2 class="font-semibold text-slate-900 dark:text-brand-100">ğŸ‰ New Trip Available: {{ new_trip.name }}</h2>
          <p class="text-sm text-slate-600 dark:text-brand-200/80 mt-1">
            ğŸ“… {{ new_trip.date|date:"D, d M Y" }} <span class="mx-1.5">â€¢</span> ğŸ“ {{ new_trip.pickup_point }}
          </p>
        </div>
        <div class="flex items-center gap-3 flex-shrink-0">
          <a href="{% url 'trips:trip-details' %}" class="text-sm font-medium text-brand-700 dark:text-brand-300 hover:underline">View details</a>
          {% if request.user.email_verified %}
            <a href="{% url 'trips:register' %}" class="inline-flex items-center rounded-lg bg-brand-500 hover:bg-brand-600 text-white px-4 py-2 font-semibold shadow-button tween">
              Join
            </a>
          {% else %}
            <a href="{% url 'accounts:resend-verification' %}" class="inline-flex items-center rounded-lg bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 font-semibold shadow-button tween">
              Verify to Join
            </a>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  {# UPCOMING #}
  <section class="space-y-4">
    <h2 class="text-xl font-heading font-semibold text-slate-800 dark:text-slate-100">Upcoming</h2>

    {% if upcoming %}
      <div class="space-y-4">
        {% for r in upcoming %}
          <article class="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-5 shadow-xl dark:shadow-2xl">
            <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-4">
              <div class="min-w-0">
                <div class="flex flex-wrap items-center gap-x-3 gap-y-2">
                  <h3 class="font-semibold text-slate-900 dark:text-slate-100 truncate">{{ r.trip.name }}</h3>
                  {% if r.status == "paid" %}
                    <span class="text-xs font-medium rounded-full bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300 px-3 py-1">Paid</span>
                  {% elif r.status == "pending" %}
                    <span class="text-xs font-medium rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300 px-3 py-1">Pending</span>
                  {% else %}
                    <span class="text-xs font-medium rounded-full bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300 px-3 py-1">Cancelled</span>
                  {% endif %}
                </div>

                <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">
                  ğŸ“… {{ r.trip.date|date:"D, d M Y" }} at {{ r.trip.meetup_time|time:"g:i A" }} from {{ r.trip.pickup_point }}
                </p>

                <dl class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1.5 text-sm">
                  <div><dt class="text-slate-500 dark:text-slate-400 inline">Name: </dt><dd class="font-semibold text-slate-700 dark:text-slate-200 inline truncate">{{ r.full_name }}</dd></div>
                  <div><dt class="text-slate-500 dark:text-slate-400 inline">Park: </dt><dd class="font-semibold text-slate-700 dark:text-slate-200 inline truncate">{{ r.get_park_choice_display }}</dd></div>
                  <div><dt class="text-slate-500 dark:text-slate-400 inline">Phone: </dt><dd class="font-semibold text-slate-700 dark:text-slate-200 inline truncate">{{ r.phone }}</dd></div>
                  <div><dt class="text-slate-500 dark:text-slate-400 inline">Ticket: </dt>
                    <dd class="font-semibold text-slate-700 dark:text-slate-200 inline truncate">
                      {% if r.imagica_transaction %}{{ r.imagica_transaction }}{% else %}
                        <span class="text-slate-500 dark:text-slate-400 font-normal">Pending booking</span>
                      {% endif %}
                    </dd>
                  </div>
                </dl>
              </div>

              <div class="text-xs text-slate-600 dark:text-slate-400 shrink-0 space-y-1 text-right sm:w-28">
                <div><span class="font-medium">Outbound:</span> 
                  {% if r.boarded_outbound %}<span class="inline-block rounded-full px-2 py-0.5 bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300">Boarded</span>{% else %}<span class="inline-block rounded-full px-2 py-0.5 bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300">Pending</span>{% endif %}
                </div>
                <div><span class="font-medium">Return:</span> 
                  {% if r.boarded_return %}<span class="inline-block rounded-full px-2 py-0.5 bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300">Boarded</span>{% else %}<span class="inline-block rounded-full px-2 py-0.5 bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300">Pending</span>{% endif %}
                </div>
              </div>
            </div>

            <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/50 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm">
              <a href="{% url 'trips:trip-details' %}" class="font-medium text-brand-600 dark:text-brand-400 hover:underline">View Trip Details</a>
              {% if r.status == "pending" %}
                <span class="text-slate-500 dark:text-slate-400">Payment pending â€” weâ€™ll contact you soon.</span>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-6 text-center text-sm text-slate-600 dark:text-slate-400 shadow-xl dark:shadow-2xl">
        You have no upcoming trips. Check out the <a href="{% url 'trips:home' %}" class="font-medium text-brand-600 dark:text-brand-400 hover:underline">latest trip</a>!
      </div>
    {% endif %}
  </section>

  {# PAST #}
  <section class="space-y-4 pt-4">
    <h2 class="text-xl font-heading font-semibold text-slate-800 dark:text-slate-100">Past Trips</h2>

    {% if past %}
      <div class="space-y-4">
        {% for r in past %}
          {# NOTE: Added opacity to de-emphasize past trips #}
          <article class="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-5 shadow-lg opacity-75">
            <div class="flex items-start justify-between gap-4">
              <div class="min-w-0">
                <div class="flex flex-wrap items-center gap-2">
                  <h3 class="font-semibold text-slate-800 dark:text-slate-200 truncate">{{ r.trip.name }}</h3>
                  <span class="text-xs font-medium rounded-full bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300 px-3 py-1">Completed</span>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
                  ğŸ“… {{ r.trip.date|date:"D, d M Y" }}
                </p>
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-6 text-center text-sm text-slate-600 dark:text-slate-400 shadow-xl dark:shadow-2xl">
        You have no past trips.
      </div>
    {% endif %}
  </section>

</div>
{% endblock %}