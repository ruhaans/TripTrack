{% extends "base.html" %}
{% block title %}{% if form.instance.pk %}Edit Trip{% else %}New Trip{% endif %} · TripTrack{% endblock %}

{% block head %}
{# NOTE: Styles for custom form inputs to match our theme #}
<style>
  /* Base styles for all form inputs */
  .trip-form-input {
    display: block; width: 100%; border-radius: 0.5rem; padding: 0.625rem 0.875rem; font-size: 0.875rem; line-height: 1.25rem; transition: all .2s ease-in-out;
  }
  .trip-form-checkbox { height: 1.25rem; width: 1.25rem; border-radius: 0.25rem; accent-color: #0d9488; }

  /* Light theme */
  .light .trip-form-input { background-color: #f8fafc; border: 1px solid #cbd5e1; color: #0f172a; }
  .light .trip-form-input:focus { --tw-ring-color: #14b8a6; border-color: #14b8a6; box-shadow: 0 0 0 2px var(--tw-ring-color); }
  .light .trip-form-checkbox { border: 1px solid #cbd5e1; }
  /* Dark theme */
  .dark .trip-form-input { background-color: #1e293b; border: 1px solid #475569; color: #f1f5f9; }
  .dark .trip-form-input:focus { --tw-ring-color: #2dd4bf; border-color: #2dd4bf; box-shadow: 0 0 0 2px var(--tw-ring-color); }
  .dark .trip-form-checkbox { background-color: #334155; border: 1px solid #475569; }
</style>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6 animate-fade-in">

  <header>
    <div class="flex items-center justify-between">
      <h1 class="text-3xl font-heading font-bold text-slate-900 dark:text-slate-100">
        {% if form.instance.pk %}Edit Trip{% else %}Create a New Trip{% endif %}
      </h1>
      <a href="{% url 'trips:trip-list' %}" class="text-sm font-semibold text-brand-600 dark:text-brand-400 hover:underline">← Back to Trips</a>
    </div>
    <p class="mt-1 text-slate-600 dark:text-slate-400">
      Set the details for your trip. Only one trip can be active at a time.
    </p>
  </header>

  <form method="post" class="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800/50 p-6 shadow-xl dark:shadow-2xl space-y-6">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="rounded-lg border border-red-200 dark:border-red-500/30 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300 text-sm p-4">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <fieldset class="space-y-4">
      <div class="sm:col-span-2">
        <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Trip Name</label>
        {{ form.name }}
        {% if form.name.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.name.errors|striptags }}</p>{% endif %}
      </div>

      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label for="{{ form.date.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Date</label>
          {{ form.date }}
          {% if form.date.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.date.errors|striptags }}</p>{% endif %}
        </div>
        <div>
          <label for="{{ form.meetup_time.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Meetup Time</label>
          {{ form.meetup_time }}
          {% if form.meetup_time.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.meetup_time.errors|striptags }}</p>{% endif %}
        </div>
      </div>
    </fieldset>

    <hr class="border-slate-200 dark:border-slate-700" />

    <fieldset class="space-y-4">
      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label for="{{ form.return_time.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Return Time (Optional)</label>
          {{ form.return_time }}
          {% if form.return_time.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.return_time.errors|striptags }}</p>{% endif %}
        </div>
        <div>
          <label for="{{ form.capacity.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Capacity</label>
          {{ form.capacity }}
          {% if form.capacity.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.capacity.errors|striptags }}</p>{% endif %}
        </div>
      </div>
      <div class="sm:col-span-2">
        <label for="{{ form.pickup_point.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Pickup Point</label>
        {{ form.pickup_point }}
        {% if form.pickup_point.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.pickup_point.errors|striptags }}</p>{% endif %}
        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">e.g., “FC Road, opposite Starbucks, Pune”</p>
      </div>
    </fieldset>

    <hr class="border-slate-200 dark:border-slate-700" />

    <fieldset>
      <label for="{{ form.details.id_for_label }}" class="block text-sm font-medium text-slate-800 dark:text-slate-300 mb-2">Trip Details</label>
      {{ form.details }}
      {% if form.details.errors %}<p class="text-xs text-red-600 dark:text-red-400 mt-1.5">{{ form.details.errors|striptags }}</p>{% endif %}
      <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">This content will be shown on the "Trip Details" page. Line breaks will be preserved.</p>
    </fieldset>
    
    <hr class="border-slate-200 dark:border-slate-700" />

    <fieldset>
      <label for="{{ form.is_active.id_for_label }}" class="flex items-center gap-4 p-4 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 cursor-pointer">
        {{ form.is_active }}
        <div>
            <span class="font-semibold text-slate-800 dark:text-slate-200">Set as active trip</span>
            <p class="text-xs text-slate-500 dark:text-slate-400">Making this the active trip will deactivate any other currently active trip.</p>
        </div>
      </label>
    </fieldset>

    <div class="flex items-center gap-4 pt-4">
      <button type="submit" class="w-full sm:w-auto px-6 py-3 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-button hover:shadow-lg hover:-translate-y-0.5 tween focus-ring">
        {% if form.instance.pk %}Save Changes{% else %}Create Trip{% endif %}
      </button>
      <a href="{% url 'trips:trip-list' %}" class="px-6 py-3 rounded-xl border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 text-sm font-semibold tween">Cancel</a>
    </div>
  </form>

</div>
{% endblock %}